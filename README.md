# Интернет-магазин: Микросервисы Заказов и Платежей

Этот проект представляет собой реализацию микросервисной архитектуры для интернет-магазина, состоящую из следующих компонентов:

- **API Gateway**: Отвечает за маршрутизацию входящих запросов к соответствующим микросервисам.
- **Orders Service**: Управляет созданием заказов, их списком и статусами. Реализует паттерн Transactional Outbox для инициирования платежей.
- **Payments Service**: Обрабатывает операции, связанные с пользовательскими счетами: создание, пополнение и просмотр баланса. Реализует паттерны Transactional Inbox и Outbox для обеспечения гарантий доставки сообщений и атомарных операций с балансом.

## Технологии

- Python 3.9+
- FastAPI: Для создания RESTful API.
- SQLAlchemy: Для работы с базой данных.
- SQLite (по умолчанию): Для простоты разработки. Может быть заменено на PostgreSQL в продакшене.
- Uvicorn: ASGI сервер для запуска FastAPI приложений.

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone <your-repository-url>
cd kpo3_p
```

### 2. Создание виртуального окружения и установка зависимостей

```bash
python -m venv venv
virtual_env\Scripts\activate
pip install -r requirements.txt
```

_Примечание: Файл `requirements.txt` будет создан позже с необходимыми зависимостями._

### 3. Запуск сервисов

Каждый сервис запускается отдельно.

#### Payments Service
```bash
# В директории payments_service
uvicorn main:app --reload --port 8001
```

#### Orders Service
```bash
# В директории orders_service
uvicorn main:app --reload --port 8002
```

#### API Gateway
```bash
# В директории api_gateway
uvicorn main:app --reload --port 8000
```

## API Эндпоинты

(Будет добавлено по мере реализации)

## Сценарий создания заказа и автооплаты

1.  **Пользователь отправляет запрос на создание нового заказа** в `API Gateway`, который перенаправляет его в `Orders Service`.
2.  **`Orders Service` создаёт заказ и задачу на оплату** в своей базе данных в рамках одной транзакции (Transactional Outbox).
3.  **`Orders Service` асинхронно извлекает задачу** из базы данных и отправляет её в очередь (или имитирует отправку, используя базу данных).
4.  **`Payments Service` извлекает задачу из очереди** (Transactional Inbox), обрабатывает её (создает счет, если его нет, списывает деньги, или регистрирует ошибку).
5.  **`Payments Service` сохраняет результат операции** в свою базу данных и асинхронно отправляет событие о статусе оплаты в очередь (Transactional Outbox).
6.  **`Orders Service` ожидает событие** об успешности/неуспешности оплаты из очереди и обновляет статус соответствующего заказа. 